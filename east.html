<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>동 East · Sacred Tree</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            overflow: hidden;
            background: #000;
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }

        /* Camera video background */
        #videoContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        #cameraVideo {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* 3D canvas overlay */
        #canvas3d {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
        }

        /* Top color bar - 5% blending into background */
        .top-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 5vh;
            background: linear-gradient(180deg, rgba(45, 106, 79, 0.8) 0%, rgba(45, 106, 79, 0) 100%);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Bottom color bar - 5% blending into background */
        .bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 5vh;
            background: linear-gradient(0deg, rgba(45, 106, 79, 0.8) 0%, rgba(45, 106, 79, 0) 100%);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Top label - Sacred Tree */
        .top-label {
            position: fixed;
            top: 6vh;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            text-align: center;
            z-index: 100;
            text-shadow: 0 2px 10px rgba(0,0,0,0.8);
            font-size: 1.2rem;
            letter-spacing: 0.3em;
        }

        /* Sacred tree connection indicator */
        .tree-connection {
            position: fixed;
            top: 5vh;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 15vh;
            background: linear-gradient(180deg, rgba(45, 106, 79, 0.8), rgba(45, 106, 79, 0.1));
            z-index: 99;
        }

        /* Bottom direction label */
        .direction-label {
            position: fixed;
            bottom: 6vh;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            text-align: center;
            z-index: 100;
            text-shadow: 0 2px 10px rgba(0,0,0,0.8);
        }
        .direction-label .korean {
            font-size: 2rem;
            font-weight: 300;
            letter-spacing: 0.3em;
        }
        .direction-label .element {
            font-size: 0.9rem;
            letter-spacing: 0.2em;
            opacity: 0.9;
            margin-top: 0.3rem;
        }

        /* Back button */
        .back-btn {
            position: fixed;
            top: 6vh;
            left: 1rem;
            width: 40px;
            height: 40px;
            background: rgba(45, 106, 79, 0.6);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            color: #fff;
            font-size: 1.2rem;
            z-index: 101;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
        }

        /* Loading overlay */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a3d2e 0%, #0d1f17 100%);
            z-index: 200;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #fff;
            transition: opacity 0.5s ease;
        }
        .loading.hidden {
            opacity: 0;
            pointer-events: none;
        }
        .loading .symbol {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.8;
        }
        .loading .text {
            font-size: 0.8rem;
            letter-spacing: 0.3em;
            opacity: 0.6;
        }

        .a-enter-vr { display: none !important; }
    </style>
</head>
<body>
    <!-- Loading -->
    <div class="loading" id="loading">
        <div class="symbol">동</div>
        <div class="text">AWAKENING</div>
    </div>

    <!-- Top bar with tree connection line -->
    <div class="top-bar"></div>
    <div class="tree-connection"></div>

    <!-- Top label - Sacred Tree -->
    <div class="top-label">신목 神木</div>

    <!-- Back button -->
    <a href="index.html" class="back-btn">←</a>

    <!-- Bottom bar -->
    <div class="bottom-bar"></div>

    <!-- Bottom direction label -->
    <div class="direction-label">
        <div class="korean">동 EAST</div>
        <div class="element">木 WOOD · SPRING</div>
    </div>

    <!-- Camera background -->
    <div id="videoContainer">
        <video id="cameraVideo" autoplay playsinline></video>
    </div>

    <!-- 3D overlay -->
    <div id="canvas3d">
        <a-scene
            embedded
            vr-mode-ui="enabled: false"
            renderer="alpha: true;">
            <a-camera position="0 0 0"></a-camera>
            <a-entity id="modelContainer"></a-entity>
        </a-scene>
    </div>

    <script>
        // Start camera
        navigator.mediaDevices.getUserMedia({ 
            video: { facingMode: 'environment' }, 
            audio: false 
        })
        .then(function(stream) {
            const video = document.getElementById('cameraVideo');
            video.srcObject = stream;
            video.play();
            
            // Load model after camera starts
            setTimeout(() => {
                createModel();
            }, 300);
        })
        .catch(function(err) {
            console.error('Camera error:', err);
            // Still try to load model
            createModel();
        });

        function createModel() {
            const container = document.getElementById('modelContainer');
            const model = document.createElement('a-entity');
            
            model.setAttribute('gltf-model', './models/model8.glb');
            model.setAttribute('position', '0 -0.5 -5');
            model.setAttribute('scale', '0.1 0.1 0.1');
            model.setAttribute('visible', true);
            
            container.appendChild(model);
            
            model.addEventListener('model-loaded', () => {
                document.getElementById('loading').classList.add('hidden');
                setTimeout(() => {
                    startGrowthAnimation(model);
                }, 100);
            });

            // Fallback if model takes too long
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
            }, 5000);
        }

        function startGrowthAnimation(model) {
            // Phase 1: Emerge from back and come forward
            model.setAttribute('animation__grow1', {
                property: 'scale',
                from: '0.1 0.1 0.1',
                to: '0.45 0.45 0.45',
                dur: 4000,
                easing: 'easeInOutQuad'
            });
            
            model.setAttribute('animation__rise1', {
                property: 'position',
                from: '0 -0.5 -5',
                to: '0 -0.5 -3.5',
                dur: 5000,
                easing: 'easeInOutQuad'
            });
            
            model.setAttribute('animation__rotate', {
                property: 'rotation',
                to: '0 360 0',
                dur: 40000,
                loop: true,
                easing: 'linear'
            });
            
            // Phase 2
            setTimeout(() => {
                model.setAttribute('animation__grow2', {
                    property: 'scale',
                    from: '0.45 0.45 0.45',
                    to: '0.8 0.8 0.8',
                    dur: 4000,
                    easing: 'easeInOutSine'
                });
                
                model.setAttribute('animation__rise2', {
                    property: 'position',
                    from: '0 -0.5 -3.5',
                    to: '0 -0.5 -2.8',
                    dur: 4000,
                    easing: 'easeInOutSine'
                });
            }, 4000);
            
            // Phase 3
            setTimeout(() => {
                model.setAttribute('animation__grow3', {
                    property: 'scale',
                    from: '0.8 0.8 0.8',
                    to: '1 1 1',
                    dur: 3000,
                    easing: 'easeOutSine'
                });
                
                model.setAttribute('animation__rise3', {
                    property: 'position',
                    from: '0 -0.5 -2.8',
                    to: '0 -0.5 -2.5',
                    dur: 5000,
                    easing: 'easeOutSine'
                });
            }, 9000);
            
            // Phase 4: Gentle back and forth
            setTimeout(() => {
                model.setAttribute('animation__float', {
                    property: 'position',
                    from: '0 -0.5 -2.8',
                    to: '0 -0.5 -2.2',
                    dur: 5000,
                    loop: true,
                    dir: 'alternate',
                    easing: 'easeInOutSine'
                });
            }, 15000);
        }
    </script>
</body>
</html>
